import"../chunks/DsnmJJEf.js";import"../chunks/69_IOA4Y.js";import{o as Ke}from"../chunks/BuerFCfO.js";import{p as Qe,c as s,s as i,t as We,g as a,a as Xe,e as l,m as g,i as Ye,r as o,h as fe,n as Ze,f as z}from"../chunks/xT3Db35F.js";import{d as $e,e as me,s as ue}from"../chunks/D_dDdLPh.js";import{i as b}from"../chunks/cVz-UtST.js";import{f as h,a as c,t as y,c as q}from"../chunks/08zest7Z.js";import{r as et,s as be}from"../chunks/CsfNHzqd.js";import{b as B}from"../chunks/58IP9Nz3.js";import{b as tt}from"../chunks/BKoGS_wq.js";import{i as at}from"../chunks/eaqFQDVP.js";var rt=h('<button type="button" class="border border-slate-400 bg-white px-2 py-0.5 text-[11px] hover:bg-slate-100">重新生成 Offer</button>'),st=h('<span class="text-emerald-600">已复制</span>'),it=h('<button type="button" class="border border-slate-400 bg-white px-3 py-1 hover:bg-slate-100">从远端 Offer 生成 Answer</button>'),ot=h('<button type="button" class="border border-slate-400 bg-white px-3 py-1 hover:bg-slate-100">应用对方的 Answer</button>'),nt=h('<span class="text-slate-500">请选择“我是发起端”或“我是应答端”后再操作。</span>'),lt=h('<span class="text-emerald-600">已复制</span>'),ct=h(`<main class="min-h-screen bg-slate-100 text-slate-900 flex items-center justify-center p-2"><div class="w-full max-w"><header class="border-b border-slate-300 pb-4 flex flex-col gap-2 md:flex-row md:items-end md:justify-between"><div><h1 class="text-2xl md:text-3xl font-semibold tracking-[0.2em] uppercase text-slate-900">P2P Media</h1></div> <div class="mt-3 md:mt-0 text-right text-[11px] text-slate-500 font-mono"><div>ROLE： <!></div> <div> </div></div></header> <section class="border border-slate-300 bg-slate-50 p-3 mb-4"><div class="mb-2 text-sm font-medium text-slate-800">选择角色</div> <p class="mb-3 text-[11px] text-slate-600">在两台设备或两个浏览器页面中打开本页面：一端点击“我是发起端”，另一端点击“我是应答端”，然后按提示复制
                / 粘贴 Offer / Answer JSON。</p> <div class="flex flex-wrap items-center gap-2"><button type="button" class="border border-slate-700 bg-slate-900 px-3 py-1 text-xs uppercase tracking-[0.15em] text-white">我是发起端</button> <button type="button" class="border border-slate-400 bg-white px-3 py-1 text-xs uppercase tracking-[0.15em] text-slate-900 hover:bg-slate-100">我是应答端</button> <span class="ml-auto text-[11px] text-slate-500"> </span></div></section> <section class="grid gap-3 md:grid-cols-2 mb-5"><div class="border border-slate-300 bg-white p-2"><div class="mb-1 flex items-center justify-between"><div class="text-xs font-medium text-slate-700"><!></div> <div class="flex items-center gap-2"><!> <button type="button" class="border border-slate-400 bg白 px-2 py-0.5 text-[11px] hover:bg-slate-100">复制</button></div></div> <textarea class="h-40 w-full border border-slate-300 bg-slate-50 p-1 font-mono text-[11px] leading-snug" readonly=""></textarea> <div class="mt-1 flex items-center justify-between text-[11px] text-slate-500"><span>生成后复制整段 JSON 发送给对方。</span> <!></div></div> <div class="border border-slate-300 bg-white p-2"><div class="mb-1 flex items-center justify-between"><div class="text-xs font-medium text-slate-700">远端描述（粘贴对方给你的 JSON）</div> <button type="button" class="border border-slate-400 bg白 px-2 py-0.5 text-[11px] hover:bg-slate-100">复制</button></div> <textarea class="h-40 w-full border border-slate-300 bg-white p-1 font-mono text-[11px] leading-snug"></textarea> <div class="mt-2 flex flex-wrap gap-2 text-[11px] items-center"><!> <!></div></div></section> <section class="border border-slate-300 bg-slate-50 p-3"><div class="mb-2 text-sm font-medium text-slate-800">步骤 2 · 同步视频地址 & 播放控制</div> <div class="mb-3 flex flex-col gap-2 md:flex-row md:items-center"><div class="flex-1"><label for="" class="block text-[11px] text-slate-600 mb-1">视频地址（例如：mp4 URL）</label> <input class="w-full border border-slate-400 px-2 py-1 text-[11px]"/></div> <div class="mt-2 md:mt-5 md:ml-3 flex gap-2 text-[11px]"><button type="button" class="border border-slate-400 bg-white px-3 py-1 hover:bg-slate-100">将地址同步给对方</button></div></div> <div><video class="w-full border border-slate-400 bg-black" controls>您的浏览器不支持 video 标签。 <track kind="captions"/></video> <p class="mt-1 text-[11px] text-slate-600">两端加载同一段视频后，任意一端点击播放 /
                    暂停，另一端会尽量同步当前时间点和状态。</p></div></section></div></main>`,2);function yt(xe,_e){Qe(_e,!1);const ge=[{urls:"stun:stun.l.google.com:19302"}];let p=g("none"),f=null,d=null,x=g(""),m=g(""),C=g(!1),J=g(!1),w=g(!1),O=g("https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4"),_=g(null),S=!1;function T(){return f||(f=new RTCPeerConnection({iceServers:ge}),f.oniceconnectionstatechange=()=>{const e=f?.iceConnectionState;e==="connected"&&l(w,!0),(e==="disconnected"||e==="failed"||e==="closed")&&l(w,!1)},f.ondatachannel=e=>{d=e.channel,H()},f)}function H(){d&&(d.onopen=()=>{},d.onclose=()=>{l(w,!1)},d.onmessage=e=>{const t=String(e.data??"");let r;try{r=JSON.parse(t)}catch{console.error("Unknown message:",t);return}if(r.kind==="media-url"){typeof r.url=="string"&&r.url.trim()&&l(O,r.url);return}if(r.kind==="media-control"){if(!a(_))return;if(S=!0,typeof r.time=="number")try{Ye(_,a(_).currentTime=r.time)}catch(u){console.error("Failed to set currentTime",u)}r.action==="play"?a(_).play().catch(u=>console.error("remote play failed",u)):r.action==="pause"&&a(_).pause();return}})}function K(e){return e.iceGatheringState==="complete"?Promise.resolve():new Promise(t=>{const r=()=>{e.iceGatheringState==="complete"&&(e.removeEventListener("icegatheringstatechange",r),t())};e.addEventListener("icegatheringstatechange",r)})}async function Q(){const e=T();d=e.createDataChannel("media"),H();const t=await e.createOffer();await e.setLocalDescription(t),await K(e),l(x,JSON.stringify(e.localDescription))}async function he(){const e=T();if(!a(m).trim()){alert("请先粘贴发起端给你的 Offer JSON。");return}const t=JSON.parse(a(m));await e.setRemoteDescription(t);const r=await e.createAnswer();await e.setLocalDescription(r),await K(e),l(x,JSON.stringify(e.localDescription))}async function ye(){if(!f){alert("请先作为发起端生成 Offer。");return}if(!a(m).trim()){alert("请粘贴应答端给你的 Answer JSON。");return}const e=JSON.parse(a(m));await f.setRemoteDescription(e)}function we(){l(p,"initiator"),l(x,""),l(m,""),Q()}function Oe(){l(p,"responder"),l(x,""),l(m,""),T()}async function Se(){if(!a(x).trim()){alert("当前没有可复制的内容。");return}try{await navigator.clipboard.writeText(a(x)),l(C,!0),setTimeout(()=>l(C,!1),1500)}catch(e){console.error(e),alert("复制失败，请手动复制文本。")}}async function ke(){if(!a(m).trim()){alert("当前没有可复制的内容。");return}try{await navigator.clipboard.writeText(a(m)),l(J,!0),setTimeout(()=>l(J,!1),1500)}catch(e){console.error(e),alert("复制失败，请手动复制文本。")}}function Ne(){if(!d||d.readyState!=="open"){alert("连接尚未建立，无法同步地址。");return}const e={kind:"media-url",url:a(O)};d.send(JSON.stringify(e))}function W(e){if(!d||d.readyState!=="open")return;const t=a(_)?.currentTime??0,r={kind:"media-control",action:e,time:t};d.send(JSON.stringify(r))}function De(){if(S){S=!1;return}W("play")}function Ce(){if(S){S=!1;return}W("pause")}Ke(()=>{d?.close(),f?.close()}),at();var E=ct(),X=s(E),A=s(X),Y=i(s(A),2),R=s(Y),Je=i(s(R));{var Te=e=>{var t=y("发起端");c(e,t)},Ee=e=>{var t=q(),r=z(t);{var u=n=>{var v=y("应答端");c(n,v)},k=n=>{var v=y("未选择");c(n,v)};b(r,n=>{a(p)==="responder"?n(u):n(k,!1)},!0)}c(e,t)};b(Je,e=>{a(p)==="initiator"?e(Te):e(Ee,!1)})}o(R);var Z=i(R,2),Ae=s(Z);o(Z),o(Y),o(A);var L=i(A,2),$=i(s(L),4),ee=s($);ee.__click=we;var te=i(ee,2);te.__click=Oe;var ae=i(te,2),Re=s(ae);o(ae),o($),o(L);var P=i(L,2),j=s(P),I=s(j),M=s(I),Le=s(M);{var Pe=e=>{var t=y("本地描述（发起端的 Offer / Answer）");c(e,t)},je=e=>{var t=q(),r=z(t);{var u=n=>{var v=y("本地描述（应答端生成的 Answer）");c(n,v)},k=n=>{var v=y("本地描述");c(n,v)};b(r,n=>{a(p)==="responder"?n(u):n(k,!1)},!0)}c(e,t)};b(Le,e=>{a(p)==="initiator"?e(Pe):e(je,!1)})}o(M);var re=i(M,2),se=s(re);{var Ie=e=>{var t=rt();t.__click=Q,c(e,t)};b(se,e=>{a(p)==="initiator"&&e(Ie)})}var Me=i(se,2);Me.__click=Se,o(re),o(I);var U=i(I,2);fe(U);var ie=i(U,2),Ue=i(s(ie),2);{var Ge=e=>{var t=st();c(e,t)};b(Ue,e=>{a(C)&&e(Ge)})}o(ie),o(j);var oe=i(j,2),G=s(oe),Ve=i(s(G),2);Ve.__click=ke,o(G);var N=i(G,2);fe(N);var ne=i(N,2),le=s(ne);{var Fe=e=>{var t=it();t.__click=he,c(e,t)},ze=e=>{var t=q(),r=z(t);{var u=n=>{var v=ot();v.__click=ye,c(n,v)},k=n=>{var v=nt();c(n,v)};b(r,n=>{a(p)==="initiator"?n(u):n(k,!1)},!0)}c(e,t)};b(le,e=>{a(p)==="responder"?e(Fe):e(ze,!1)})}var qe=i(le,2);{var Be=e=>{var t=lt();c(e,t)};b(qe,e=>{a(J)&&e(Be)})}o(ne),o(oe),o(P);var ce=i(P,2),V=i(s(ce),2),F=s(V),de=i(s(F),2);et(de),o(F);var ve=i(F,2),He=s(ve);He.__click=Ne,o(ve),o(V);var pe=i(V,2),D=s(pe);tt(D,e=>l(_,e),()=>a(_)),Ze(2),o(pe),o(ce),o(X),o(E),We(()=>{ue(Ae,`STATE：${a(w)?"CONNECTED":"DISCONNECTED"}`),ue(Re,`当前状态：${a(w)?"已连接 ✅":"未连接"}`),be(N,"placeholder",a(p)==="responder"?"粘贴发起端给你的 Offer JSON":a(p)==="initiator"?"粘贴应答端给你的 Answer JSON":"请先在上方选择角色（发起端 / 应答端）"),be(D,"src",a(O))}),B(U,()=>a(x),e=>l(x,e)),B(N,()=>a(m),e=>l(m,e)),B(de,()=>a(O),e=>l(O,e)),me("play",D,De),me("pause",D,Ce),c(xe,E),Xe()}$e(["click"]);export{yt as component};
